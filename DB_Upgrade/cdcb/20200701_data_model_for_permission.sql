
 CREATE TABLE GROUPS
(
	GROUP_ID INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) PRIMARY KEY,
	GROUP_NAME VARCHAR(128) NOT NULL 
);

CREATE TABLE USERS
(
	USER_ID INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) PRIMARY KEY,
	USER_NAME VARCHAR(128) NOT NULL,
	PASSWORD VARCHAR(128) NOT NULL 
);

CREATE TABLE ROLES
(
	ROLE_ID INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) PRIMARY KEY,
	ROLE_NAME VARCHAR(128) NOT NULL 
);

CREATE TABLE FEATURES
(
	FEATURE_ID INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) PRIMARY KEY,
	FEATURE_NAME VARCHAR(128) NOT NULL,
	PAGE VARCHAR(128) 
);

CREATE TABLE PERMISSIONS
(
	PERMISSION_ID INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) PRIMARY KEY,
	PERMISSION_NAME VARCHAR(128) NOT NULL 
);


CREATE TABLE USER_GROUPS
(
	USER_ID INT NOT NULL,
	GROUP_ID INT NOT NULL,
	CONSTRAINT USER_GROUP_PK PRIMARY KEY(USER_ID,GROUP_ID)
);
ALTER TABLE USER_GROUPS ADD CONSTRAINT FK_USER_GROUP_USER_ID FOREIGN KEY (USER_ID) REFERENCES   USERS (USER_ID) ON DELETE CASCADE; 
ALTER TABLE USER_GROUPS ADD CONSTRAINT FK_USER_GROUP_GROUP_ID FOREIGN KEY (GROUP_ID) REFERENCES GROUPS (GROUP_ID) ON DELETE CASCADE; 
 

  
 
CREATE TABLE GROUP_ROLES
( 
	GROUP_ID INT NOT NULL,
	ROLE_ID INT NOT NULL,
	CONSTRAINT GROUP_ROLE_PK PRIMARY KEY(GROUP_ID, ROLE_ID)
);

ALTER TABLE GROUP_ROLES ADD CONSTRAINT FK_GROUP_ROLE_GROUP_ID FOREIGN KEY (GROUP_ID) REFERENCES GROUPS (GROUP_ID) ON DELETE CASCADE ; 
ALTER TABLE GROUP_ROLES ADD CONSTRAINT FK_GROUP_ROLE_ROLE_ID FOREIGN KEY (ROLE_ID) REFERENCES  ROLES (ROLE_ID) ON DELETE CASCADE ; 
 
  
CREATE TABLE ROLE_FEATURE_PERMISSIONS
( 
	ROLE_ID INT NOT NULL,
	FEATURE_ID INT NOT NULL,
	PERMISSION_ID INT NOT NULL,
	CONSTRAINT ROLE_FEATURE_PERMISSION_PK PRIMARY KEY(ROLE_ID, FEATURE_ID, PERMISSION_ID)
); 
ALTER TABLE ROLE_FEATURE_PERMISSIONS ADD CONSTRAINT FK_RFP_ROLE_ID FOREIGN KEY (ROLE_ID) REFERENCES  ROLES (ROLE_ID) ON DELETE CASCADE ; 
ALTER TABLE ROLE_FEATURE_PERMISSIONS ADD CONSTRAINT FK_RFP_FEATURE_ID FOREIGN KEY (FEATURE_ID) REFERENCES  FEATURES (FEATURE_ID) ON DELETE CASCADE ; 
ALTER TABLE ROLE_FEATURE_PERMISSIONS ADD CONSTRAINT FK_RFP_PERMISSION_ID FOREIGN KEY (PERMISSION_ID) REFERENCES  PERMISSIONS (PERMISSION_ID) ON DELETE CASCADE ; 
 
 
INSERT INTO GROUPS(GROUP_NAME) VALUES ('Administrators');
INSERT INTO GROUPS(GROUP_NAME) VALUES ('BA Teams');
INSERT INTO GROUPS(GROUP_NAME) VALUES ('Dev Teams');
INSERT INTO GROUPS(GROUP_NAME) VALUES ('DataGene SMEs');
INSERT INTO GROUPS(GROUP_NAME) VALUES ('CDCB SMEs');
INSERT INTO GROUPS(GROUP_NAME) VALUES ('Anonymous');
INSERT INTO GROUPS(GROUP_NAME) VALUES ('Guest');
INSERT INTO GROUPS(GROUP_NAME) VALUES ('Report Users');
 


INSERT INTO USERS(USER_NAME,PASSWORD) VALUES ('Admin','Pass1');
INSERT INTO USERS(USER_NAME,PASSWORD) VALUES ('Duy','Pass1');
INSERT INTO USERS(USER_NAME,PASSWORD) VALUES ('Tien','Pass1');
INSERT INTO USERS(USER_NAME,PASSWORD) VALUES ('Nghi','Pass1');
INSERT INTO USERS(USER_NAME,PASSWORD) VALUES ('Hillary','Pass1');
INSERT INTO USERS(USER_NAME,PASSWORD) VALUES ('Phu','Pass1');
INSERT INTO USERS(USER_NAME,PASSWORD) VALUES ('Erika','Pass1');
INSERT INTO USERS(USER_NAME,PASSWORD) VALUES ('Kendra','Pass1'); 
INSERT INTO USERS(USER_NAME,PASSWORD) VALUES ('user1','Pass1');
INSERT INTO USERS(USER_NAME,PASSWORD) VALUES ('user2','Pass1');
INSERT INTO USERS(USER_NAME,PASSWORD) VALUES ('Anonymous','');


INSERT INTO ROLES(ROLE_NAME) VALUES ('Administration');
INSERT INTO ROLES(ROLE_NAME) VALUES ('Report Users');
INSERT INTO ROLES(ROLE_NAME) VALUES ('Guest');
  
INSERT INTO FEATURES(FEATURE_NAME,PAGE) VALUES ('Animal Info', 'Queries');
INSERT INTO FEATURES(FEATURE_NAME,PAGE) VALUES ('Herd Info', 'Queries');
INSERT INTO FEATURES(FEATURE_NAME,PAGE) VALUES ('Top Animal Listing', 'Top Animal Listing');
INSERT INTO FEATURES(FEATURE_NAME,PAGE) VALUES ('Genetic and Phenotypic Trend', 'Summary Stats');
INSERT INTO FEATURES(FEATURE_NAME,PAGE) VALUES ('Merit Percentile Table', 'Summary Stats');
INSERT INTO FEATURES(FEATURE_NAME,PAGE) VALUES ('Breed mean, base, het', 'Summary Stats');
INSERT INTO FEATURES(FEATURE_NAME,PAGE) VALUES ('Comparision Active AI Bulls', 'Summary Stats');
INSERT INTO FEATURES(FEATURE_NAME,PAGE) VALUES ('Metrics', 'Metrics');

INSERT INTO PERMISSIONS(PERMISSION_NAME) VALUES ('All');
INSERT INTO PERMISSIONS(PERMISSION_NAME) VALUES ('View'); 
 

INSERT INTO USER_GROUPS(USER_ID,GROUP_ID)  
SELECT u.USER_ID, g.GROUP_ID
FROM USERS u
CROSS JOIN GROUPS g
where g.group_name ='Administrators'
and u.user_name in 
('Admin' );



INSERT INTO USER_GROUPS(USER_ID,GROUP_ID)  
SELECT u.USER_ID, g.GROUP_ID 
FROM USERS u
CROSS JOIN GROUPS g
where g.group_name ='BA Teams'
and u.user_name in 
('Hillary',
'Phu'
 );

INSERT INTO USER_GROUPS(USER_ID,GROUP_ID)  
SELECT u.USER_ID, g.GROUP_ID 
FROM USERS u
CROSS JOIN GROUPS g
where g.group_name ='Dev Teams'
and u.user_name in 
('Nghi',
'Tien',
'Duy'
 );
 

INSERT INTO USER_GROUPS(USER_ID,GROUP_ID)  
SELECT u.USER_ID, g.GROUP_ID 
FROM USERS u
CROSS JOIN GROUPS g
where g.group_name ='DataGene SMEs'
and u.user_name in 
('Erika' 
 );
 
INSERT INTO USER_GROUPS(USER_ID,GROUP_ID)  
SELECT u.USER_ID, g.GROUP_ID 
FROM USERS u
CROSS JOIN GROUPS g
where g.group_name ='CDCB SMEs'
and u.user_name in 
('Kendra' 
 );
 
INSERT INTO USER_GROUPS(USER_ID,GROUP_ID)  
SELECT u.USER_ID, g.GROUP_ID 
FROM USERS u
CROSS JOIN GROUPS g
where g.group_name ='Guest'
and u.user_name in 
('user1' 
 );
 
 
 INSERT INTO USER_GROUPS(USER_ID,GROUP_ID)  
SELECT u.USER_ID, g.GROUP_ID 
FROM USERS u
CROSS JOIN GROUPS g
where g.group_name ='Report Users'
and u.user_name in 
('user2' 
 );
 
 
 INSERT INTO USER_GROUPS(USER_ID,GROUP_ID)  
SELECT u.USER_ID, g.GROUP_ID 
FROM USERS u
CROSS JOIN GROUPS g
where g.group_name ='Anonymous'
and u.user_name in 
('Anonymous' 
 );

 

INSERT INTO GROUP_ROLES(GROUP_ID, ROLE_ID)  
SELECT g.GROUP_ID, r.ROLE_ID
FROM GROUPS g
CROSS JOIN ROLES r
where r.role_name ='Administration'
and g.group_name in 
('Administrators',
'BA Teams',
'Dev Teams',
'DataGene SMEs',
'CDCB SMEs'
 );



INSERT INTO GROUP_ROLES(GROUP_ID, ROLE_ID)  
SELECT g.GROUP_ID, r.ROLE_ID
FROM GROUPS g
CROSS JOIN ROLES r
where r.role_name ='Guest'
and g.group_name in 
('Anonymous',
'Guest' 
 );

INSERT INTO GROUP_ROLES(GROUP_ID, ROLE_ID)  
SELECT g.GROUP_ID, r.ROLE_ID
FROM GROUPS g
CROSS JOIN ROLES r
where r.role_name ='Report Users'
and g.group_name in 
('Report Users' 
 );



INSERT INTO ROLE_FEATURE_PERMISSIONS(ROLE_ID,FEATURE_ID,PERMISSION_ID)  
SELECT r.ROLE_ID, f.FEATURE_ID, p.PERMISSION_ID 
FROM ROLES r
CROSS JOIN FEATURES f
CROSS JOIN PERMISSIONS p 
where r.role_name ='Administration'
and f.feature_name in 
('Animal Info',
'Herd Info',
'Top Animal Listing',
'Genetic and Phenotypic Trend',
'Merit Percentile Table',
'Breed mean, base, het',
'Comparision Active AI Bulls',
'Metrics'
 )
 and p.PERMISSION_NAME in ('All')
 ;

INSERT INTO ROLE_FEATURE_PERMISSIONS(ROLE_ID,FEATURE_ID,PERMISSION_ID)  
SELECT r.ROLE_ID, f.FEATURE_ID, p.PERMISSION_ID 
FROM ROLES r
CROSS JOIN FEATURES f
CROSS JOIN PERMISSIONS p 
where r.role_name ='Report Users'
and f.feature_name in 
('Animal Info',
'Herd Info',
'Top Animal Listing',
'Genetic and Phenotypic Trend',
'Merit Percentile Table',
'Breed mean, base, het',
'Comparision Active AI Bulls',
'Metrics'
 )
 and p.PERMISSION_NAME in ('View')
 ;

INSERT INTO ROLE_FEATURE_PERMISSIONS(ROLE_ID,FEATURE_ID,PERMISSION_ID)  
SELECT r.ROLE_ID, f.FEATURE_ID, p.PERMISSION_ID 
FROM ROLES r
CROSS JOIN FEATURES f
CROSS JOIN PERMISSIONS p 
where r.role_name ='Guest'
and f.feature_name in 
( 
'Top Animal Listing',
'Genetic and Phenotypic Trend',
'Merit Percentile Table',
'Breed mean, base, het',
'Comparision Active AI Bulls',
'Metrics'
 )
 and p.PERMISSION_NAME in ('View')
 ;
   
-- Update password by hash value
update users set PASSWORD='$2b$12$8msO26s5I97jouiWfxD2w.ani20E2NilK6yYqZBDP2E6Cp6gPn0qq'
